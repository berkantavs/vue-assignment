{"ast":null,"code":"import ContactSearch from './ContactSearch';\nimport VueSelect from 'vue-select';\nimport 'flatpickr/dist/flatpickr.css';\nimport FlatPickr from 'vue-flatpickr-component';\nimport { updateRecords } from '../services/appointmentsService';\nexport default {\n  props: [\"allRecords\", 'record', \"contacts\", \"agents\"],\n  components: {\n    ContactSearch,\n    VueSelect,\n    flatPickr: FlatPickr\n  },\n  data() {\n    return {\n      selectedContact: null,\n      appointmentAddress: null,\n      selectedAgent: [],\n      appointmentDate: '',\n      selectedContactId: null,\n      config: {\n        enableTime: true,\n        time_24hr: true\n      },\n      relatedAppointmentsStatus: []\n    };\n  },\n  mounted() {\n    this.initializeEditForm();\n  },\n  watch: {\n    record: {\n      immediate: true,\n      handler() {\n        this.initializeEditForm(); // Modal açıldığında formu güncelle\n      }\n    },\n    contacts: 'initializeEditForm',\n    relatedAppointments: {\n      immediate: true,\n      handler() {\n        // this.calculatePositiveHoursAndDays();\n      }\n    }\n  },\n  computed: {\n    agentList() {\n      return this.agents.map(agent => ({\n        id: agent?.id,\n        label: `${agent?.fields?.agent_name} ${agent?.fields?.agent_surname}`\n      }));\n    },\n    relatedAppointments() {\n      return this.allRecords.filter(appointment => this.selectedContact?.fields?.appointments.includes(appointment?.id));\n    }\n  },\n  methods: {\n    calculatePositiveHoursAndDays() {\n      this.relatedAppointmentsStatus = this.relatedAppointments.map(appointment => {\n        const start = new Date();\n        const end = new Date(appointment?.fields.appointment_date);\n        let difference = end - start;\n        const millisecondsPerSecond = 1000;\n        const secondsPerMinute = 60;\n        const minutesPerHour = 60;\n        const hoursPerDay = 24;\n        let milliseconds = difference % millisecondsPerSecond;\n        difference = (difference - milliseconds) / millisecondsPerSecond;\n        let seconds = difference % secondsPerMinute;\n        difference = (difference - seconds) / secondsPerMinute;\n        let minutes = difference % minutesPerHour;\n        difference = (difference - minutes) / minutesPerHour;\n        let hours = difference % hoursPerDay;\n        let days = (difference - hours) / hoursPerDay;\n        days = Math.max(0, days);\n        hours = Math.max(0, hours);\n        let remainingText = '';\n        if (days > 0) {\n          remainingText = `${days} days`;\n        } else if (days <= 0 && hours > 0) {\n          remainingText = `${hours} hours`;\n        }\n        let status = '';\n        let statusColor = '';\n        const now = new Date();\n        if (appointment?.fields?.is_cancelled) {\n          status = 'Cancelled';\n          statusColor = '#ff0000';\n          remainingText = '';\n        } else if (end > now) {\n          status = 'Upcoming';\n          statusColor = '#ffa500';\n        } else {\n          status = 'Completed';\n          statusColor = '#008000';\n          remainingText = '';\n        }\n        return {\n          date: appointment?.fields?.appointment_date,\n          status,\n          statusColor,\n          remainingText\n        };\n      });\n    },\n    formatAppointmentDate(dateString) {\n      if (dateString) {\n        const date = new Date(dateString);\n        const day = String(date.getUTCDate()).padStart(2, '0');\n        const month = String(date.getUTCMonth() + 1).padStart(2, '0');\n        const year = date.getUTCFullYear();\n        const hours = String(date.getUTCHours()).padStart(2, '0');\n        const minutes = String(date.getUTCMinutes()).padStart(2, '0');\n        return `${day}/${month}/${year} ${hours}:${minutes}`;\n      }\n    },\n    initializeEditForm() {\n      if (this.contacts && this.record?.fields?.contact_id) {\n        const contact = this.contacts.find(contact => contact?.id === this.record?.fields?.contact_id[0]);\n        if (contact) {\n          this.selectedContact = contact;\n        }\n      }\n      if (this.record?.fields?.appointment_address) {\n        this.appointmentAddress = this.record?.fields?.appointment_address;\n      }\n      if (this.record.fields.agent_id) {\n        this.selectedAgent = this.record.fields?.agent_id.map((id, index) => ({\n          id: id,\n          label: `${this.record?.fields?.agent_name[index]} ${this.record?.fields?.agent_surname[index]}`\n        }));\n      }\n      if (this.record?.fields?.appointment_date) {\n        this.appointmentDate = this.record?.fields?.appointment_date;\n      }\n    },\n    setContact(contact) {\n      this.selectedContact = contact;\n    },\n    async submitAppointment() {\n      const updatedAppointment = {\n        id: this.record.id,\n        fields: {\n          appointment_date: this.appointmentDate,\n          appointment_address: this.appointmentAddress,\n          contact_id: [this.selectedContact.id],\n          agent_id: this.selectedAgent.map(agent => agent.id)\n        }\n      };\n      try {\n        const response = await updateRecords('Appointments', [updatedAppointment]);\n        console.log('Appointment updated:', response);\n      } catch (error) {\n        console.error('Error updating appointment:', error);\n      }\n    }\n  }\n};","map":{"version":3,"names":["ContactSearch","VueSelect","FlatPickr","updateRecords","props","components","flatPickr","data","selectedContact","appointmentAddress","selectedAgent","appointmentDate","selectedContactId","config","enableTime","time_24hr","relatedAppointmentsStatus","mounted","initializeEditForm","watch","record","immediate","handler","contacts","relatedAppointments","computed","agentList","agents","map","agent","id","label","fields","agent_name","agent_surname","allRecords","filter","appointment","appointments","includes","methods","calculatePositiveHoursAndDays","start","Date","end","appointment_date","difference","millisecondsPerSecond","secondsPerMinute","minutesPerHour","hoursPerDay","milliseconds","seconds","minutes","hours","days","Math","max","remainingText","status","statusColor","now","is_cancelled","date","formatAppointmentDate","dateString","day","String","getUTCDate","padStart","month","getUTCMonth","year","getUTCFullYear","getUTCHours","getUTCMinutes","contact_id","contact","find","appointment_address","agent_id","index","setContact","submitAppointment","updatedAppointment","response","console","log","error"],"sources":["src/components/EditAppointmentModal.vue"],"sourcesContent":["<template>\n    <div class=\"appointment-modal\">\n        <b-modal hide-backdrop :id=\"'appointment-modal-' + record?.id\" hide-footer hide-header-close\n            header-class=\"d-block\" content-class=\"grey-background\">\n            <template #modal-header=\"{}\">\n                <div class=\"text-center\">\n                    <b-icon class=\"me-2\" icon=\"calendar-plus\" font-scale=\"1.1\"></b-icon>\n                    <b>Edit appointment</b>\n                </div>\n            </template>\n            <div class=\"search-contact-area\">\n                <ContactSearch :contacts=\"contacts\" @setContact=\"setContact\" :selectedContactInfo=\"selectedContact\"\n                    :formType=\"'edit'\" />\n            </div>\n            <div class=\"appointment-address-input-area mt-3\">\n                <b-form-input type=\"text\" v-model=\"appointmentAddress\" placeholder=\"Address\"></b-form-input>\n            </div>\n            <div class=\"status-select-box-area mt-3\">\n                <VueSelect multiple v-model=\"selectedAgent\" :options=\"agentList\" placeholder=\"Agent\" />\n            </div>\n            <div class=\"date-selector-area mt-3\">\n                <flat-pickr :model-value=\"appointmentDate\" :config=\"config\"\n                    @update:modelValue=\"appointmentDate = $event\" class=\"form-control\"></flat-pickr>\n            </div>\n            <div class=\"related-appointments-area mt-3\"\n                v-if=\"relatedAppointmentsStatus && relatedAppointmentsStatus.length > 0\">\n                <b>Related Appointments</b>\n                <div class=\"mt-2\">\n                    <template v-for=\"(status, index) in relatedAppointmentsStatus\">\n                        <div class=\"mb-2\" :key=\"index\">\n                            <div class=\"appointment-status-box bg-primary\">\n                                <b-row class=\"m-0\">\n                                    <b-col lg=\"6\" class=\"status-area text-center\">\n                                        <b-row>\n                                            <b-col :lg=\"status.remainingText === '' ? '12' : 6\">\n                                                <span class=\"p-1\" :style=\"'color:' + status.statusColor\">{{\n                                                    status.status }}</span>\n                                            </b-col>\n                                            <b-col :lg=\"status.remainingText === '' ? '12' : 6\">\n                                                <span>{{ status.remainingText }}</span>\n                                            </b-col>\n                                        </b-row>\n                                    </b-col>\n                                    <b-col lg=\"6\" class=\"date-area text-center\">\n                                        <b-icon class=\"text-white\" font-scale=\"0.9\" icon=\"clock\"></b-icon>\n                                        <span class=\"text-white ms-1\" style=\"font-size: 14px;\">{{\n                                            formatAppointmentDate(status.date) }}</span>\n                                    </b-col>\n                                </b-row>\n                            </div>\n                        </div>\n                    </template>\n                </div>\n            </div>\n            <div class=\"submit-button-area mt-3 text-end\">\n                <b-button variant=\"primary\" @click=\"submitAppointment\">Submit</b-button>\n            </div>\n        </b-modal>\n    </div>\n</template>\n\n<script>\nimport ContactSearch from './ContactSearch';\nimport VueSelect from 'vue-select';\nimport 'flatpickr/dist/flatpickr.css';\nimport FlatPickr from 'vue-flatpickr-component';\nimport { updateRecords } from '../services/appointmentsService';\n\nexport default {\n    props: [\"allRecords\", 'record', \"contacts\", \"agents\"],\n    components: {\n        ContactSearch,\n        VueSelect,\n        flatPickr: FlatPickr,\n    },\n    data() {\n        return {\n            selectedContact: null,\n            appointmentAddress: null,\n            selectedAgent: [],\n            appointmentDate: '',\n            selectedContactId: null,\n            config: {\n                enableTime: true,\n                time_24hr: true,\n            },\n            relatedAppointmentsStatus: []\n        };\n    },\n    mounted() {\n        this.initializeEditForm();\n    },\n    watch: {\n        record: {\n            immediate: true,\n            handler() {\n                this.initializeEditForm(); // Modal açıldığında formu güncelle\n            }\n        },\n        contacts: 'initializeEditForm',\n        relatedAppointments: {\n            immediate: true,\n            handler() {\n                // this.calculatePositiveHoursAndDays();\n            }\n        }\n    },\n    computed: {\n        agentList() {\n            return this.agents.map(agent => ({\n                id: agent?.id,\n                label: `${agent?.fields?.agent_name} ${agent?.fields?.agent_surname}`,\n            }));\n        },\n        relatedAppointments() {\n            return this.allRecords.filter(appointment =>\n                this.selectedContact?.fields?.appointments.includes(appointment?.id)\n            );\n        }\n    },\n    methods: {\n        calculatePositiveHoursAndDays() {\n            this.relatedAppointmentsStatus = this.relatedAppointments.map(appointment => {\n                const start = new Date();\n                const end = new Date(appointment?.fields.appointment_date);\n                let difference = end - start;\n                const millisecondsPerSecond = 1000;\n                const secondsPerMinute = 60;\n                const minutesPerHour = 60;\n                const hoursPerDay = 24;\n\n                let milliseconds = difference % millisecondsPerSecond;\n                difference = (difference - milliseconds) / millisecondsPerSecond;\n                let seconds = difference % secondsPerMinute;\n                difference = (difference - seconds) / secondsPerMinute;\n                let minutes = difference % minutesPerHour;\n                difference = (difference - minutes) / minutesPerHour;\n                let hours = difference % hoursPerDay;\n                let days = (difference - hours) / hoursPerDay;\n\n                days = Math.max(0, days);\n                hours = Math.max(0, hours);\n\n                let remainingText = '';\n                if (days > 0) {\n                    remainingText = `${days} days`;\n                } else if (days <= 0 && hours > 0) {\n                    remainingText = `${hours} hours`;\n                }\n\n                let status = '';\n                let statusColor = '';\n                const now = new Date();\n                if (appointment?.fields?.is_cancelled) {\n                    status = 'Cancelled';\n                    statusColor = '#ff0000';\n                    remainingText = '';\n                } else if (end > now) {\n                    status = 'Upcoming';\n                    statusColor = '#ffa500';\n                } else {\n                    status = 'Completed';\n                    statusColor = '#008000';\n                    remainingText = '';\n                }\n\n                return {\n                    date: appointment?.fields?.appointment_date,\n                    status,\n                    statusColor,\n                    remainingText\n                };\n            });\n        },\n        formatAppointmentDate(dateString) {\n            if (dateString) {\n                const date = new Date(dateString);\n                const day = String(date.getUTCDate()).padStart(2, '0');\n                const month = String(date.getUTCMonth() + 1).padStart(2, '0');\n                const year = date.getUTCFullYear();\n                const hours = String(date.getUTCHours()).padStart(2, '0');\n                const minutes = String(date.getUTCMinutes()).padStart(2, '0');\n\n                return `${day}/${month}/${year} ${hours}:${minutes}`;\n            }\n        },\n        initializeEditForm() {\n            if (this.contacts && this.record?.fields?.contact_id) {\n                const contact = this.contacts.find(contact => contact?.id === this.record?.fields?.contact_id[0]);\n                if (contact) {\n                    this.selectedContact = contact;\n                }\n            }\n            if (this.record?.fields?.appointment_address) {\n                this.appointmentAddress = this.record?.fields?.appointment_address;\n            }\n            if (this.record.fields.agent_id) {\n                this.selectedAgent = this.record.fields?.agent_id.map((id, index) => ({\n                    id: id,\n                    label: `${this.record?.fields?.agent_name[index]} ${this.record?.fields?.agent_surname[index]}`,\n                }));\n            }\n            if (this.record?.fields?.appointment_date) {\n                this.appointmentDate = this.record?.fields?.appointment_date;\n            }\n        },\n        setContact(contact) {\n            this.selectedContact = contact;\n        },\n\n        async submitAppointment() {\n            const updatedAppointment = {\n                id: this.record.id,\n                fields: {\n                    appointment_date: this.appointmentDate,\n                    appointment_address: this.appointmentAddress,\n                    contact_id: [this.selectedContact.id],\n                    agent_id: this.selectedAgent.map(agent => agent.id)\n                }\n            };\n\n            try {\n                const response = await updateRecords('Appointments', [updatedAppointment]);\n                console.log('Appointment updated:', response);\n            } catch (error) {\n                console.error('Error updating appointment:', error);\n            }\n        }\n    }\n};\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}